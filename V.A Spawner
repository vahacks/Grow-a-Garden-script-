-- V.A Hackz — Giftable Remote Pet Spawner added (LocalScript -> StarterGui)
-- Place in StarterGui. Requires executor with game:HttpGet & loadstring for any remote-run features.
-- NOTE: Gifting to other players requires a server RemoteEvent (see code comments). If not present,
--       script will fallback to running remote spawner locally (only visible to you).

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- ---------------- Utilities ----------------
local function safeDestroy(obj)
    if obj and obj.Destroy then pcall(function() obj:Destroy() end) end
end

local function findFirst(tbl, val)
    for _,v in ipairs(tbl) do if v == val then return true end end
    return false
end

local function getHumanoid()
    return player.Character and player.Character:FindFirstChildOfClass("Humanoid")
end
local function getHRP()
    return player.Character and player.Character:FindFirstChild("HumanoidRootPart")
end

-- ---------------- State / Folders ----------------
local STATE = {
    scriptEnabled = true,
    autoGrow = false,
    flyEnabled = false,
    speedEnabled = false,
    jumpEnabled = false,
    pets = {}, -- local pets
    selectedPet = "Kitsune"
}

local gardenFolder = workspace:FindFirstChild("Plants") or (function() local f=Instance.new("Folder", workspace); f.Name="Plants"; return f end)()
local petsFolder = workspace:FindFirstChild("Pets") or (function() local f=Instance.new("Folder", workspace); f.Name="Pets"; return f end)()

-- cleanup prior GUIs named V.A Hackz
for _,c in ipairs(playerGui:GetChildren()) do
    if type(c.Name) == "string" and c.Name:match("^V%.A Hackz") then safeDestroy(c) end
end

-- ---------------- Core local actions ----------------
local function growPlant()
    if not STATE.scriptEnabled then return end
    local hrp = getHRP(); if not hrp then return end
    local p = Instance.new("Part")
    p.Name = "VA_Plant"; p.Anchored = true; p.CanCollide = false
    p.BrickColor = BrickColor.new("Lime green")
    p.Size = Vector3.new(0.2,0.2,0.2)
    p.CFrame = hrp.CFrame * CFrame.new(0,0,5)
    p.Parent = gardenFolder
    for i=1,12 do
        if not p.Parent then break end
        p.Size = p.Size + Vector3.new(0.4,0.4,0.4)
        task.wait(0.03)
    end
end

local function spawnPetLocal(petType)
    if not STATE.scriptEnabled then return end
    local hrp = getHRP(); if not hrp then return end
    local k = Instance.new("Part")
    k.Name = "VA_"..(petType or STATE.selectedPet)
    k.Size = Vector3.new(10,10,10)
    k.Position = hrp.Position + Vector3.new(math.random(-5,5),0,math.random(5,10))
    k.Anchored = false; k.CanCollide = true
    if petType == "Kitsune" then k.BrickColor = BrickColor.new("Bright orange")
    elseif petType == "Raccoon" then k.BrickColor = BrickColor.new("Medium stone grey")
    elseif petType == "Ostrich" then k.BrickColor = BrickColor.new("White")
    else k.BrickColor = BrickColor.new("Really red") end
    k.Parent = petsFolder
    local bp = Instance.new("BodyPosition", k)
    bp.MaxForce = Vector3.new(1e6,1e6,1e6); bp.P = 6000; bp.D = 200
    bp.Position = k.Position
    table.insert(STATE.pets, { part = k, bp = bp })
end

local function updatePets()
    local hrp = getHRP(); if not hrp then return end
    for i = #STATE.pets, 1, -1 do
        local ent = STATE.pets[i]
        if not ent.part or not ent.part.Parent then table.remove(STATE.pets, i)
        else
            local ox, oz = math.random(-6,6), math.random(-6,6)
            local target = hrp.Position + Vector3.new(ox, 5 + math.random(), oz)
            pcall(function() ent.bp.Position = target end)
        end
    end
end
RunService.Heartbeat:Connect(function() pcall(updatePets) end)

-- ---------------- GUI (core V.A Hackz) ----------------
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "V.A Hackz"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Name = "Main"
mainFrame.Size = UDim2.new(0,420,0,520)
mainFrame.Position = UDim2.new(0.5,-210,0.5,-260)
mainFrame.AnchorPoint = Vector2.new(0.5,0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(20,120,20)
mainFrame.BorderSizePixel = 2
mainFrame.Active = true; mainFrame.Draggable = true

local topBar = Instance.new("Frame", mainFrame)
topBar.Size = UDim2.new(1,0,0,50)
topBar.Position = UDim2.new(0,0,0,0)
topBar.BackgroundColor3 = Color3.fromRGB(10,80,10)

local title = Instance.new("TextLabel", topBar)
title.Size = UDim2.new(0.7,0,1,0); title.Position = UDim2.new(0,10,0,0)
title.BackgroundTransparency = 1; title.Font = Enum.Font.GothamBold; title.TextSize = 20; title.TextColor3 = Color3.new(1,1,1)
title.Text = "V.A Hackz — Giftable Pets"

local closeBtn = Instance.new("TextButton", topBar)
closeBtn.Size = UDim2.new(0,40,0,30); closeBtn.Position = UDim2.new(1,-50,0,10)
closeBtn.Text = "X"; closeBtn.Font = Enum.Font.GothamBold; closeBtn.TextSize = 16
closeBtn.BackgroundColor3 = Color3.fromRGB(150,0,0); closeBtn.TextColor3 = Color3.fromRGB(1,1,1)

local floatingBtn = Instance.new("TextButton", screenGui)
floatingBtn.Size = UDim2.new(0,60,0,60); floatingBtn.Position = UDim2.new(0,10,0,100)
floatingBtn.Text = "V.A"; floatingBtn.Font = Enum.Font.GothamBold; floatingBtn.TextSize = 18
floatingBtn.BackgroundColor3 = Color3.fromRGB(0,150,0); floatingBtn.BorderSizePixel = 1
floatingBtn.Visible = false; floatingBtn.Active = true; floatingBtn.Draggable = true

local scroll = Instance.new("ScrollingFrame", mainFrame)
scroll.Size = UDim2.new(1,-20,1,-70); scroll.Position = UDim2.new(0,10,0,60)
scroll.ScrollBarThickness = 8; scroll.BackgroundTransparency = 1
local layout = Instance.new("UIListLayout", scroll); layout.Padding = UDim.new(0,10); layout.SortOrder = Enum.SortOrder.LayoutOrder

local function createButton(text, parent, callback)
    local btn = Instance.new("TextButton", parent or scroll)
    btn.Size = UDim2.new(1,0,0,38)
    btn.Font = Enum.Font.GothamBold; btn.TextSize = 16
    btn.BackgroundColor3 = Color3.fromRGB(0,110,0); btn.TextColor3 = Color3.fromRGB(1,1,1); btn.Text = text
    btn.BorderSizePixel = 1
    btn.MouseButton1Click:Connect(function() pcall(function() callback(btn) end) end)
    -- hover
    btn.MouseEnter:Connect(function() pcall(function() TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = Color3.fromRGB(0,170,0)}):Play() end) end)
    btn.MouseLeave:Connect(function() pcall(function() TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = Color3.fromRGB(0,110,0)}):Play() end) end)
    return btn
end

-- ---- Core buttons (local features) ----
createButton("Grow Plant (Local)", nil, function() growPlant() end)
local autoBtn = createButton("Auto Grow: OFF", nil, function(btn) STATE.autoGrow = not STATE.autoGrow; btn.Text = STATE.autoGrow and "Auto Grow: ON" or "Auto Grow: OFF" end)

createButton("Spawn Kitsune (Local)", nil, function() spawnPetLocal("Kitsune") end)
createButton("Spawn Raccoon (Local)", nil, function() spawnPetLocal("Raccoon") end)
createButton("Spawn Ostrich (Local)", nil, function() spawnPetLocal("Ostrich") end)

createButton("Delete All Pets (Local)", nil, function()
    for i=#STATE.pets,1,-1 do local e = STATE.pets[i]; if e.part and e.part.Parent then safeDestroy(e.part) end; table.remove(STATE.pets,i) end
end)

-- movement toggles (simple)
local speedBtn = createButton("Speed Hack: OFF", nil, function(btn)
    STATE.speedEnabled = not STATE.speedEnabled; btn.Text = STATE.speedEnabled and "Speed Hack: ON" or "Speed Hack: OFF"
    if STATE.speedEnabled then
        local hum = getHumanoid(); if hum then hum.WalkSpeed = 100 end
    else
        local hum = getHumanoid(); if hum then hum.WalkSpeed = 16 end
    end
end)

local jumpBtn = createButton("Jump Hack: OFF", nil, function(btn)
    STATE.jumpEnabled = not STATE.jumpEnabled; btn.Text = STATE.jumpEnabled and "Jump Hack: ON" or "Jump Hack: OFF"
    if STATE.jumpEnabled then local hum = getHumanoid(); if hum then hum.JumpPower = 200 end else local hum = getHumanoid(); if hum then hum.JumpPower = 50 end end
end)

local flyBtn = createButton("Fly Hack: OFF", nil, function(btn)
    STATE.flyEnabled = not STATE.flyEnabled; btn.Text = STATE.flyEnabled and "Fly Hack: ON" or "Fly Hack: OFF"
    if STATE.flyEnabled then
        -- simple fly enable (safe defaults)
        local hrp = getHRP(); if hrp then
            if not hrp:FindFirstChild("VA_FlyBV") then
                local bv = Instance.new("BodyVelocity"); bv.Name="VA_FlyBV"; bv.MaxForce=Vector3.new(9e5,9e5,9e5); bv.Velocity=Vector3.new(0,0,0); bv.Parent=hrp
                local bg = Instance.new("BodyGyro"); bg.Name="VA_FlyBG"; bg.MaxTorque=Vector3.new(9e5,9e5,9e5); bg.Parent=hrp
            end
        end
    else
        local hrp=getHRP(); if hrp then if hrp:FindFirstChild("VA_FlyBV") then safeDestroy(hrp:FindFirstChild("VA_FlyBV")) end; if hrp:FindFirstChild("VA_FlyBG") then safeDestroy(hrp:FindFirstChild("VA_FlyBG")) end end
    end
end)

createButton("Restore Movement Defaults", nil, function()
    local hum = getHumanoid()
    if hum then
        hum.WalkSpeed = 16
        if hum.JumpPower then hum.JumpPower = 50 end
    end
    -- remove local fly parts
    local hrp = getHRP()
    if hrp then
        if hrp:FindFirstChild("VA_FlyBV") then safeDestroy(hrp:FindFirstChild("VA_FlyBV")) end
        if hrp:FindFirstChild("VA_FlyBG") then safeDestroy(hrp:FindFirstChild("VA_FlyBG")) end
    end
    STATE.speedEnabled=false; STATE.jumpEnabled=false; STATE.flyEnabled=false
end)

-- ---------------- Gift UI ----------------
local giftLabel = Instance.new("TextLabel", scroll)
giftLabel.Size = UDim2.new(1,0,0,24); giftLabel.BackgroundTransparency = 1
giftLabel.Font = Enum.Font.GothamBold; giftLabel.TextSize = 15; giftLabel.TextColor3 = Color3.fromRGB(240,240,240)
giftLabel.Text = "🎁 Gift Pet to another player"

-- Player dropdown
local playerDropdown = Instance.new("TextButton", scroll)
playerDropdown.Size = UDim2.new(1,0,0,36); playerDropdown.Text = "Select Player"
playerDropdown.Font = Enum.Font.GothamBold; playerDropdown.TextSize = 14; playerDropdown.BackgroundColor3 = Color3.fromRGB(10,90,10); playerDropdown.TextColor3 = Color3.fromRGB(1,1,1)

local playersFrame = Instance.new("Frame", scroll)
playersFrame.Size = UDim2.new(1,0,0,120); playersFrame.BackgroundColor3 = Color3.fromRGB(8,50,8); playersFrame.Visible = false
local playersLayout = Instance.new("UIListLayout", playersFrame); playersLayout.Padding = UDim.new(0,4)

playerDropdown.MouseButton1Click:Connect(function()
    playersFrame:ClearAllChildren(); playersLayout.Parent = playersFrame
    playersFrame.Visible = not playersFrame.Visible
    if playersFrame.Visible then
        for _,pl in ipairs(Players:GetPlayers()) do
            if pl ~= player then
                local b = Instance.new("TextButton", playersFrame)
                b.Size = UDim2.new(1,-6,0,28); b.Text = pl.Name; b.Font = Enum.Font.Gotham; b.TextSize = 14
                b.BackgroundColor3 = Color3.fromRGB(10,80,10); b.TextColor3 = Color3.fromRGB(1,1,1)
                b.MouseButton1Click:Connect(function()
                    playerDropdown.Text = "🎯 "..pl.Name
                    playersFrame.Visible = false
                end)
            end
        end
    end
end)

-- Pet dropdown
local petDropdown = Instance.new("TextButton", scroll)
petDropdown.Size = UDim2.new(1,0,0,36); petDropdown.Position = UDim2.new(0,0,0,0)
petDropdown.Text = "Select Pet (Kitsune)"
petDropdown.Font = Enum.Font.GothamBold; petDropdown.TextSize = 14; petDropdown.BackgroundColor3 = Color3.fromRGB(10,90,10); petDropdown.TextColor3 = Color3.fromRGB(1,1,1)

local petFrame = Instance.new("Frame", scroll)
petFrame.Size = UDim2.new(1,0,0,120); petFrame.BackgroundColor3 = Color3.fromRGB(8,50,8); petFrame.Visible = false
local petLayout = Instance.new("UIListLayout", petFrame); petLayout.Padding = UDim.new(0,4)

local petTypes = {"Kitsune","Raccoon","Ostrich","Dragon","Unicorn"}
petDropdown.MouseButton1Click:Connect(function()
    petFrame:ClearAllChildren(); petLayout.Parent = petFrame
    petFrame.Visible = not petFrame.Visible
    if petFrame.Visible then
        for _,p in ipairs(petTypes) do
            local b = Instance.new("TextButton", petFrame)
            b.Size = UDim2.new(1,-6,0,28); b.Text = p; b.Font = Enum.Font.Gotham; b.TextSize = 14
            b.BackgroundColor3 = Color3.fromRGB(10,80,10); b.TextColor3 = Color3.fromRGB(1,1,1)
            b.MouseButton1Click:Connect(function()
                petDropdown.Text = "🐾 "..p
                STATE.selectedPet = p
                petFrame.Visible = false
            end)
        end
    end
end)

-- Log box
local logBox = Instance.new("TextLabel", scroll)
logBox.Size = UDim2.new(1,0,0,80); logBox.TextWrapped = true; logBox.TextYAlignment = Enum.TextYAlignment.Top
logBox.BackgroundColor3 = Color3.fromRGB(6,60,6); logBox.TextColor3 = Color3.fromRGB(220,220,220)
logBox.Font = Enum.Font.Code; logBox.TextSize = 14
logBox.Text = "Log:\n"

-- Helper to append log
local function appendLog(txt)
    logBox.Text = logBox.Text .. "\n" .. txt
end

-- Attempt to find likely RemoteEvent names in ReplicatedStorage
local candidateRemoteNames = {"VA_SpawnPet", "SpawnPet", "PetSpawner", "RemotePetEvent", "GivePet", "SpawnRemotePet"}

local function findServerRemote()
    for _,name in ipairs(candidateRemoteNames) do
        local ev = ReplicatedStorage:FindFirstChild(name)
        if ev and ev:IsA("RemoteEvent") then return ev, name end
    end
    return nil, nil
end

-- Gift button
local giftBtn = createButton("Gift Selected Pet to Player", nil, function(btn)
    local selected = playerDropdown.Text
    local petType = STATE.selectedPet or "Kitsune"
    if not (selected:find("🎯")) then
        appendLog("Choose a player first.")
        btn.Text = "Select Player!"
        task.delay(1.3, function() if btn and btn.Parent then btn.Text = "Gift Selected Pet to Player" end end)
        return
    end

    local targetName = selected:gsub("🎯%s*","")
    local targetPlayer = Players:FindFirstChild(targetName)
    if not targetPlayer then
        appendLog("Player not found: "..targetName)
        btn.Text = "Player not found"
        task.delay(1.5, function() if btn and btn.Parent then btn.Text = "Gift Selected Pet to Player" end end)
        return
    end

    -- Try to find a server RemoteEvent to ask server to gift the pet to target player
    local remoteEvent, remoteName = findServerRemote()
    if remoteEvent then
        -- Try a few common parameter shapes defensively
        local fired = false
        local attempts = {
            function() remoteEvent:FireServer(targetPlayer.UserId, petType) end,
            function() remoteEvent:FireServer(targetPlayer, petType) end,
            function() remoteEvent:FireServer(targetName, petType) end,
            function() remoteEvent:FireServer({target = targetPlayer, pet = petType}) end
        }

        for i,fn in ipairs(attempts) do
            local ok,err = pcall(fn)
            if ok then
                appendLog("Fired RemoteEvent '"..remoteName.."' (attempt "..i..") to gift "..petType.." to "..targetName)
                btn.Text = "Gift Sent ✅"
                fired = true
                break
            else
                appendLog("Attempt "..i.." failed: "..tostring(err))
            end
        end

        if not fired then
            appendLog("RemoteEvent found ("..remoteName..") but all call attempts failed. Check server API.")
            btn.Text = "Server Call Failed"
            task.delay(1.6, function() if btn and btn.Parent then btn.Text = "Gift Selected Pet to Player" end end)
        else
            task.delay(1.6, function() if btn and btn.Parent then btn.Text = "Gift Selected Pet to Player" end end)
        end
        return
    end

    -- No server RemoteEvent available -> fallback to local remote-run (client-only)
    appendLog("No server RemoteEvent found. Gift cannot be performed for other players on server.")
    btn.Text = "No server support — Running local spawner"
    task.delay(1, function()
        -- run remote pet spawner locally as a demo (only visible to you)
        local ok, err = pcall(function()
            -- safe call to remote script (review its code!)
            local url = "https://raw.githubusercontent.com/Kizaki143/Pet-SpawnerGAG/refs/heads/main/OPScriptGAG"
            local code = game:HttpGet(url)
            local fn = loadstring(code)
            if type(fn) == "function" then fn() end
        end)
        if ok then
            appendLog("Local remote-run executed for demo (you only).")
            btn.Text = "Demo Ran ✅"
        else
            appendLog("Local remote-run failed: "..tostring(err))
            btn.Text = "Local Run Error"
        end
        task.delay(1.6, function() if btn and btn.Parent then btn.Text = "Gift Selected Pet to Player" end end)
    end)
end)

-- ---------------- Remote-run buttons (your original remote-run) ----------------
createButton("Run Remote Pet Spawner (local)", nil, function()
    local ok,err = pcall(function()
        local url = "https://raw.githubusercontent.com/Kizaki143/Pet-SpawnerGAG/refs/heads/main/OPScriptGAG"
        local code = game:HttpGet(url)
        local fn = loadstring(code)
        if type(fn) == "function" then fn() end
    end)
    if ok then appendLog("Remote Pet Spawner executed locally.") else appendLog("Remote run failed: "..tostring(err)) end
end)

-- ---------------- Misc / UX ----------------
-- Floating button show/hide
local tweenInfoShort = TweenInfo.new(0.28, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
closeBtn.MouseButton1Click:Connect(function()
    -- slide + fade out
    pcall(function() TweenService:Create(mainFrame, tweenInfoShort, {Position = UDim2.new(0.5, -210, 0.5, -700)}):Play() end)
    floatingBtn.Position = UDim2.new(0, -80, 0, 100); floatingBtn.Visible = true
    TweenService:Create(floatingBtn, tweenInfoShort, {Position = UDim2.new(0, 10, 0, 100)}):Play()
    task.delay(0.32, function() mainFrame.Visible = false; mainFrame.Position = UDim2.new(0.5,-210,0.5,-260) end)
end)
floatingBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = true; floatingBtn.Visible = false
    mainFrame.Position = UDim2.new(0.5, -210, 0.5, -700)
    TweenService:Create(mainFrame, tweenInfoShort, {Position = UDim2.new(0.5, -210, 0.5, -260)}):Play()
end)

-- small helper: refresh player list when players join/leave
Players.PlayerAdded:Connect(function() end) -- dropdown repopulates on open
Players.PlayerRemoving:Connect(function()
    -- if selected player left, reset dropdown
    if playerDropdown.Text:find("🎯") then
        local name = playerDropdown.Text:gsub("🎯%s*","")
        if not Players:FindFirstChild(name) then playerDropdown.Text = "Select Player" end
    end
end)

-- Auto-Grow loop
task.spawn(function()
    while true do
        task.wait(0.6)
        if STATE.autoGrow and STATE.scriptEnabled then pcall(growPlant) end
    end
end)

-- Respawn handling (restore movement/hacks)
player.CharacterAdded:Connect(function()
    task.delay(0.6, function()
        if STATE.speedEnabled then local hum = getHumanoid(); if hum then hum.WalkSpeed = 100 end end
        if STATE.jumpEnabled then local hum = getHumanoid(); if hum then hum.JumpPower = 200 end end
    end)
end)

print("V.A Hackz — Giftable Remote Pet Spawner UI loaded. Check the Log panel for results.")
